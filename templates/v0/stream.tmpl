# NGINX configuration file - Stream servers - generated by https://github.com/fabriziofiorucci/NGINX-Config-Generator

{# --- Upstreams section --- #}

{% if declaration.upstreams %}
{% for u in declaration.upstreams %}
upstream {{ u.name }} {
    zone {{ u.name }} 64k;
    {% for o in u.origin -%}
    server {{ o.server }}{% if o.weight %} weight={{ o.weight }}{% endif %}{% if o.max_fails %} max_fails={{ o.max_fails }}{% endif %}{% if o.fail_timeout %} fail_timeout={{ o.fail_timeout }}{% endif %}{% if o.max_conns %} max_conns={{ o.max_conns }}{% endif %}{% if o.slow_start %} slow_start={{ o.slow_start }}{% endif %}{% if o.backup and o.backup == True %} backup{% endif %};
    {% endfor %}

    {% if u.snippet %}{{ u.snippet }}{% endif %}

}
{% endfor %}
{% endif %}


{# --- Stream server section --- #}

{% for s in declaration.servers %}
server {
    {% if s.listen -%}
    listen {{ s.listen.address }}{% if s.listen.protocol %} {{ s.listen.protocol }}{% endif %};
    {% endif -%}

    {% if s.upstream -%}
    proxy_pass {{ s.upstream }};
    {% endif %}

    {% if s.snippet %}{{ s.snippet }}{% endif %}

}

{% endfor %}